<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Devicon CSS for tech icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css">
  <style>
    .project-detail-layout {
      min-height: 100vh;
      display: flex;
      background: #f9fafb;
    }
    .project-content {
      flex: 1;
      padding: 2.5rem 3rem;
      margin-left: 280px;
    }
    .project-hero {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #fef2f2 60%, #ffe4e6 100%);
      border-radius: 24px;
      padding: 3rem;
      color: #111827;
      overflow: hidden;
      box-shadow: 0 25px 80px rgba(17,24,39,0.15);
    }
    .project-hero::after {
      content: "";
      position: absolute;
      top: -20%;
      right: -10%;
      width: 40%;
      height: 120%;
      background: radial-gradient(circle, rgba(197,29,52,0.2), transparent 60%);
      filter: blur(40px);
      opacity: 0.8;
      pointer-events: none;
    }
    .project-hero > * {
      position: relative;
      z-index: 2;
    }
    /* Flying Tech Icons Animation */
    .flying-tech-icons {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
      pointer-events: none;
      border-radius: 24px;
    }
    .flying-tech-icons i {
      position: absolute;
      font-size: 2.5rem;
      color: #c51d34;
      opacity: 0;
      left: -100px;
      animation: flyLeftToRight 12s linear infinite, glowBlink 2s ease-in-out infinite;
      filter: drop-shadow(0 0 10px rgba(197, 29, 52, 0.3));
    }
    /* Stagger the icons with different delays and vertical positions */
    .flying-tech-icons i:nth-child(1) { top: 10%; animation-delay: 0s, 0s; }
    .flying-tech-icons i:nth-child(2) { top: 20%; animation-delay: 2s, 0.3s; }
    .flying-tech-icons i:nth-child(3) { top: 35%; animation-delay: 4s, 0.6s; }
    .flying-tech-icons i:nth-child(4) { top: 50%; animation-delay: 1s, 0.9s; }
    .flying-tech-icons i:nth-child(5) { top: 65%; animation-delay: 3s, 1.2s; }
    .flying-tech-icons i:nth-child(6) { top: 80%; animation-delay: 5s, 1.5s; }
    .flying-tech-icons i:nth-child(7) { top: 15%; animation-delay: 6s, 0.2s; }
    .flying-tech-icons i:nth-child(8) { top: 45%; animation-delay: 7s, 0.5s; }
    .flying-tech-icons i:nth-child(9) { top: 70%; animation-delay: 2.5s, 0.8s; }
    .flying-tech-icons i:nth-child(10) { top: 25%; animation-delay: 4.5s, 1.1s; }
    .flying-tech-icons i:nth-child(11) { top: 55%; animation-delay: 1.5s, 1.4s; }
    .flying-tech-icons i:nth-child(12) { top: 85%; animation-delay: 3.5s, 1.7s; }
    .flying-tech-icons i:nth-child(13) { top: 12%; animation-delay: 5.5s, 0.4s; }
    .flying-tech-icons i:nth-child(14) { top: 40%; animation-delay: 7.5s, 0.7s; }
    .flying-tech-icons i:nth-child(15) { top: 60%; animation-delay: 0.5s, 1s; }
    .flying-tech-icons i:nth-child(16) { top: 75%; animation-delay: 2.8s, 1.3s; }
    .flying-tech-icons i:nth-child(17) { top: 30%; animation-delay: 4.8s, 1.6s; }
    .flying-tech-icons i:nth-child(18) { top: 48%; animation-delay: 6.8s, 1.9s; }
    .flying-tech-icons i:nth-child(19) { top: 18%; animation-delay: 8s, 0.1s; }
    .flying-tech-icons i:nth-child(20) { top: 90%; animation-delay: 1.8s, 0.3s; }
    /* Alternate colors for variety */
    .flying-tech-icons i:nth-child(odd) {
      color: #c51d34;
      filter: drop-shadow(0 0 10px rgba(197, 29, 52, 0.3));
    }
    .flying-tech-icons i:nth-child(even) {
      color: #4285F4;
      filter: drop-shadow(0 0 10px rgba(66, 133, 244, 0.3));
    }
    @keyframes flyLeftToRight {
      0% {
        left: -100px;
        opacity: 0;
        transform: translateY(0) rotate(0deg);
      }
      10% {
        opacity: 0.25;
      }
      50% {
        opacity: 0.35;
        transform: translateY(-20px) rotate(180deg);
      }
      90% {
        opacity: 0.25;
      }
      100% {
        left: calc(100% + 100px);
        opacity: 0;
        transform: translateY(0) rotate(360deg);
      }
    }
    @keyframes glowBlink {
      0%, 100% {
        filter: drop-shadow(0 0 5px currentColor) brightness(1);
      }
      50% {
        filter: drop-shadow(0 0 20px currentColor) brightness(1.5);
      }
    }
    .project-status-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.35rem 1rem;
      border-radius: 999px;
      font-weight: 600;
      background: rgba(17,24,39,0.08);
      backdrop-filter: blur(6px);
      font-size: 0.95rem;
      color: #111827;
    }
    .status-dot.complete {
      background: #10b981;
    }
    .status-dot.in-progress {
      background: #facc15;
    }
    .project-hero h1 {
      margin: 1rem 0;
      font-size: clamp(2rem, 4vw, 3rem);
    }
    .project-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .project-meta-item {
      min-width: 140px;
      padding: 1rem;
      border-radius: 16px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
    }
    .service-icon-display {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: rgba(197, 29, 52, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1.5px solid rgba(197, 29, 52, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #c51d34;
      font-size: 1.5rem;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: 0 4px 15px rgba(197, 29, 52, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    .service-icon-display img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 6px;
      filter: drop-shadow(0 2px 4px rgba(197, 29, 52, 0.3));
    }
    .service-meta-with-icon {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .service-title-wrapper {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }
    .project-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.5rem;
      margin-top: 2.5rem;
    }
    .project-card {
      background: white;
      border-radius: 20px;
      padding: 1.75rem;
      box-shadow: 0 15px 40px rgba(15,23,42,0.08);
      border: 1px solid #e5e7eb;
    }
    .project-card h3 {
      margin-bottom: 0.75rem;
      font-size: 1rem;
      color: #111827;
    }
    .project-grid-section {
      margin-top: 2.5rem;
    }
    .progress-ring {
      position: relative;
      width: 140px;
      height: 140px;
      margin: 1rem auto;
    }
    .progress-ring svg {
      transform: rotate(-90deg);
    }
    .progress-ring-value {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: 700;
      color: #c51d34;
    }
    .project-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .gallery-item {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      aspect-ratio: 16/10;
      box-shadow: 0 12px 30px rgba(15,23,42,0.18);
      cursor: pointer;
    }
    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }
    .gallery-item:hover img {
      transform: scale(1.05);
    }
    .gallery-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .gallery-item:hover .gallery-overlay {
      opacity: 1;
    }
    .gallery-overlay i {
      color: white;
      font-size: 2rem;
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }
    .gallery-item:hover .gallery-overlay i {
      transform: scale(1);
    }
    .tech-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem 0.5rem 1rem;
      border-radius: 20px;
      background: linear-gradient(135deg, #c51d34 0%, #a01628 100%);
      border: none;
      color: white;
      font-size: 0.875rem;
      font-weight: 600;
      margin: 0.375rem 0.375rem 0.375rem 0;
      box-shadow: 0 2px 8px rgba(197, 29, 52, 0.25), 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
      position: relative;
      overflow: hidden;
    }
    .tech-pill::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }
    .tech-pill:hover {
      background: linear-gradient(135deg, #a01628 0%, #8a1323 100%);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 4px 12px rgba(197, 29, 52, 0.35), 0 2px 6px rgba(0, 0, 0, 0.15);
    }
    .tech-pill:hover::before {
      left: 100%;
    }
    .tech-pill i {
      font-size: 1.25rem;
      width: 24px;
      text-align: center;
      flex-shrink: 0;
    }
    .timeline-wrapper {
      margin-top: 3rem;
    }
    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    .timeline {
      position: relative;
      margin-left: 1.5rem;
      padding-left: 1.5rem;
    }
    .timeline::before {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      width: 3px;
      background: linear-gradient(180deg, #c51d34, #f97316);
      border-radius: 999px;
    }
    .timeline-card {
      position: relative;
      background: white;
      border-radius: 18px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 30px rgba(15,23,42,0.08);
    }
    .timeline-card::before {
      content: "";
      position: absolute;
      left: -2rem;
      top: 32px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 3px solid white;
      background: #c51d34;
      box-shadow: 0 0 0 6px rgba(197,29,52,0.15);
    }
    .timeline-card.completed::before {
      background: #10b981;
      box-shadow: 0 0 0 6px rgba(16,185,129,0.2);
    }
    .timeline-card.highlighted {
      background: linear-gradient(135deg, #fef7f7 0%, #fef2f2 100%);
      border: 2px solid rgba(197, 29, 52, 0.3);
      box-shadow: 0 15px 35px rgba(197, 29, 52, 0.15);
      transform: translateY(-4px);
      animation: highlightPulse 3s ease-in-out infinite;
      position: relative;
      overflow: hidden;
    }
    .timeline-card.highlighted::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(197, 29, 52, 0.08), transparent);
      animation: shimmer 3s ease-in-out infinite;
    }
    .timeline-card.highlighted::before {
      background: #f97316;
      box-shadow: 0 0 0 6px rgba(249,115,22,0.25);
      animation: dotPulse 2s ease-in-out infinite;
    }
    @keyframes highlightPulse {
      0%, 100% {
        border-color: rgba(197, 29, 52, 0.3);
        box-shadow: 0 15px 35px rgba(197, 29, 52, 0.15);
      }
      50% {
        border-color: rgba(197, 29, 52, 0.5);
        box-shadow: 0 15px 40px rgba(197, 29, 52, 0.2);
      }
    }
    @keyframes shimmer {
      0% {
        left: -100%;
      }
      50% {
        left: 100%;
      }
      100% {
        left: 100%;
      }
    }
    @keyframes dotPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 0 6px rgba(249,115,22,0.25);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 0 0 8px rgba(249,115,22,0.35);
      }
    }
    .timeline-card h4 {
      margin: 0;
      font-size: 1.2rem;
      color: #111827;
    }
    .timeline-meta {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin: 0.5rem 0 1rem;
      color: #6b7280;
      font-size: 0.9rem;
    }
    .milestone-progress {
      --progress: 0%;
      height: 8px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .milestone-progress-fill {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(135deg, #c51d34, #f97316);
      width: var(--progress);
    }
    .tasks-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      background: #f9fafb;
      border-radius: 12px;
      padding: 0.85rem 1rem;
      border: 1px solid #e5e7eb;
    }
    .task-item.completed {
      border-color: rgba(16,185,129,0.4);
      background: rgba(16,185,129,0.08);
    }
    .task-icon {
      margin-top: 0.1rem;
      color: #c51d34;
    }
    .task-item.completed .task-icon {
      color: #10b981;
    }
    .task-item strong {
      font-size: 0.95rem;
      color: #111827;
      display: block;
    }
    .task-item p {
      margin: 0.25rem 0 0;
      font-size: 0.85rem;
      color: #6b7280;
    }
    .empty-state {
      background: white;
      border-radius: 20px;
      padding: 3rem;
      text-align: center;
      border: 1px dashed #d1d5db;
      color: #6b7280;
    }
    /* Tablet and below */
    @media (max-width: 1024px) {
      .project-content {
        margin-left: 0;
        padding: 1.5rem;
      }
      .project-hero {
        padding: 2rem;
      }
      .project-hero h1 {
        font-size: clamp(1.75rem, 5vw, 2.5rem);
      }
      .project-meta {
        gap: 1rem;
      }
      .project-meta-item {
        min-width: 120px;
        padding: 0.875rem;
      }
      .project-grid {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.25rem;
      }
      .project-card[style*="grid-column: span 2"] {
        grid-column: span 1 !important;
      }
      .timeline {
        margin-left: 0;
        padding-left: 1rem;
      }
      .timeline-card::before {
        left: -1.6rem;
      }
      .project-gallery {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }

    /* Mobile devices */
    @media (max-width: 768px) {
      .project-content {
        padding: 1rem;
      }

      .project-hero {
        padding: 1.5rem;
        border-radius: 16px;
      }

      .project-hero h1 {
        font-size: 1.75rem;
        margin: 0.75rem 0;
        line-height: 1.2;
      }

      .project-hero p {
        font-size: 0.9375rem;
        line-height: 1.5;
        max-width: 100%;
      }

      .project-status-chip {
        font-size: 0.875rem;
        padding: 0.3rem 0.875rem;
      }

      .project-meta {
        flex-direction: column;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .project-meta-item {
        min-width: 100%;
        width: 100%;
        padding: 1rem;
      }

      .service-title-wrapper {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .service-icon-display {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
      }

      .project-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .project-card {
        padding: 1.25rem;
        border-radius: 16px;
      }

      .project-card h3 {
        font-size: 0.9375rem;
        margin-bottom: 1rem;
      }

      .project-card[style*="grid-column: span 2"] {
        grid-column: span 1 !important;
      }

      .progress-ring {
        width: 120px;
        height: 120px;
        margin: 0.75rem auto;
      }

      .progress-ring svg {
        width: 120px;
        height: 120px;
      }

      .progress-ring svg circle {
        r: 52;
        cx: 60;
        cy: 60;
        stroke-width: 10;
      }

      .progress-ring-value {
        font-size: 1.5rem;
      }

      .progress-ring svg circle[stroke-dasharray] {
        stroke-dasharray: calc(2 * 3.14159 * 52);
      }

      .project-card > div[style*="display:flex"] {
        flex-direction: column;
        gap: 1.5rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] {
        min-width: 100%;
      }

      .project-card > div[style*="display:flex"] h2 {
        font-size: 1.5rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="display:flex"] {
        flex-direction: column;
        gap: 0.75rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] p {
        font-size: 0.875rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] h2 {
        font-size: 1.75rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] > div[style*="display:flex"] {
        flex-direction: column;
        gap: 1rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] > div[style*="display:flex"] p {
        font-size: 0.8125rem;
        margin: 0;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] > div[style*="display:flex"] strong {
        font-size: 0.9375rem;
      }

      .btn {
        width: 100%;
        padding: 0.875rem 1.5rem;
        font-size: 0.875rem;
        min-height: 44px;
        justify-content: center;
      }

      .tech-pill {
        font-size: 0.8125rem;
        padding: 0.4375rem 0.625rem 0.4375rem 0.875rem;
        margin: 0.25rem 0.25rem 0.25rem 0;
      }

      .tech-pill i {
        font-size: 1rem;
        width: 20px;
      }

      .project-gallery {
        grid-template-columns: 1fr;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      .gallery-item {
        aspect-ratio: 16/10;
        border-radius: 12px;
      }

      .cover-image-clickable {
        max-height: 350px !important;
      }

      .timeline-wrapper {
        margin-top: 2rem;
      }

      .timeline-header {
        margin-bottom: 1.25rem;
      }

      .timeline-header h2 {
        font-size: 1.5rem;
      }

      .timeline-header p {
        font-size: 0.875rem;
      }

      .timeline {
        margin-left: 0;
        padding-left: 0.75rem;
      }

      .timeline::before {
        width: 2px;
      }

      .timeline-card {
        padding: 1.25rem;
        margin-bottom: 1.25rem;
        border-radius: 16px;
      }

      .timeline-card::before {
        left: -1.25rem;
        width: 14px;
        height: 14px;
        border-width: 2px;
        top: 28px;
      }

      .timeline-card h4 {
        font-size: 1.125rem;
      }

      .timeline-meta {
        flex-direction: column;
        gap: 0.5rem;
        font-size: 0.875rem;
        margin: 0.75rem 0;
      }

      .timeline-meta span {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .milestone-progress {
        height: 6px;
        margin-bottom: 0.875rem;
      }

      .tasks-list {
        gap: 0.625rem;
      }

      .task-item {
        padding: 0.75rem;
        border-radius: 10px;
      }

      .task-item strong {
        font-size: 0.875rem;
      }

      .task-item p {
        font-size: 0.8125rem;
      }

      .empty-state {
        padding: 2rem 1.5rem;
        border-radius: 16px;
      }

      .empty-state i {
        font-size: 2.5rem;
        margin-bottom: 0.75rem;
      }

      .empty-state h3 {
        font-size: 1.25rem;
      }

      .empty-state p {
        font-size: 0.9375rem;
      }

      /* Reduce flying icons on mobile for performance */
      .flying-tech-icons i {
        font-size: 2rem;
      }

      .flying-tech-icons i:nth-child(n+10) {
        display: none;
      }
    }

    /* Small mobile devices */
    @media (max-width: 480px) {
      .project-content {
        padding: 0.75rem;
      }

      .project-hero {
        padding: 1.25rem;
        border-radius: 12px;
      }

      .project-hero h1 {
        font-size: 1.5rem;
        margin: 0.5rem 0;
      }

      .project-hero p {
        font-size: 0.875rem;
      }

      .project-status-chip {
        font-size: 0.8125rem;
        padding: 0.25rem 0.75rem;
      }

      .project-meta {
        gap: 0.875rem;
        margin-top: 1.25rem;
      }

      .project-meta-item {
        padding: 0.875rem;
      }

      .service-icon-display {
        width: 36px;
        height: 36px;
        font-size: 1.125rem;
      }

      .project-grid {
        gap: 0.875rem;
        margin-top: 1.25rem;
      }

      .project-card {
        padding: 1rem;
        border-radius: 12px;
      }

      .project-card h3 {
        font-size: 0.875rem;
      }

      .progress-ring {
        width: 100px;
        height: 100px;
      }

      .progress-ring svg {
        width: 100px;
        height: 100px;
      }

      .progress-ring svg circle {
        r: 44;
        cx: 50;
        cy: 50;
        stroke-width: 8;
      }

      .progress-ring-value {
        font-size: 1.25rem;
      }

      .project-card > div[style*="display:flex"] h2 {
        font-size: 1.25rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] h2 {
        font-size: 1.5rem;
      }

      .project-card > div[style*="display:flex"] > div[style*="flex:1"] > div[style*="display:flex"] {
        gap: 0.875rem;
      }

      .project-card > div[style*="display:flex"] p {
        font-size: 0.875rem;
      }

      .project-card > div[style*="display:flex"] strong {
        font-size: 0.9375rem;
      }

      .tech-pill {
        font-size: 0.75rem;
        padding: 0.375rem 0.5rem 0.375rem 0.75rem;
        margin: 0.25rem 0.125rem 0.25rem 0;
      }

      .tech-pill i {
        font-size: 0.875rem;
        width: 18px;
      }

      .project-gallery {
        gap: 0.625rem;
      }

      .gallery-item {
        border-radius: 10px;
      }

      .cover-image-clickable {
        max-height: 300px !important;
      }

      .timeline-wrapper {
        margin-top: 1.5rem;
      }

      .timeline-header h2 {
        font-size: 1.25rem;
      }

      .timeline-header p {
        font-size: 0.8125rem;
      }

      .timeline {
        padding-left: 0.5rem;
      }

      .timeline-card {
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 12px;
      }

      .timeline-card::before {
        left: -1rem;
        width: 12px;
        height: 12px;
        top: 24px;
      }

      .timeline-card h4 {
        font-size: 1rem;
      }

      .timeline-meta {
        font-size: 0.8125rem;
      }

      .task-item {
        padding: 0.625rem;
      }

      .task-item strong {
        font-size: 0.8125rem;
      }

      .task-item p {
        font-size: 0.75rem;
      }

      .empty-state {
        padding: 1.5rem 1rem;
      }

      .empty-state i {
        font-size: 2rem;
      }

      .empty-state h3 {
        font-size: 1.125rem;
      }

      .empty-state p {
        font-size: 0.875rem;
      }

      /* Further reduce flying icons on small screens */
      .flying-tech-icons i:nth-child(n+8) {
        display: none;
      }
    }

    /* Image Modal Responsive Styles */
    .image-modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.95);
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .modal-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10001;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0.7) 0%, transparent 100%);
    }

    .modal-counter {
      color: white;
      font-weight: 600;
      font-size: 0.9375rem;
    }

    .modal-close {
      color: white;
      font-size: 2rem;
      font-weight: 300;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      transition: background 0.3s ease;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .modal-prev,
    .modal-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: white;
      font-size: 2rem;
      cursor: pointer;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
      z-index: 10001;
    }

    .modal-prev {
      left: 1rem;
    }

    .modal-next {
      right: 1rem;
    }

    .modal-prev:hover,
    .modal-next:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .modal-content {
      position: relative;
      max-width: 90%;
      max-height: 90%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 3rem;
    }

    .modal-content img {
      max-width: 100%;
      max-height: calc(100vh - 120px);
      object-fit: contain;
      border-radius: 8px;
      transition: transform 0.3s ease;
    }

    .modal-zoom-controls {
      position: absolute;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 0.5rem;
      z-index: 10001;
    }

    .zoom-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 1.125rem;
    }

    .zoom-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    @media (max-width: 768px) {
      .modal-header {
        padding: 0.75rem;
      }

      .modal-counter {
        font-size: 0.875rem;
      }

      .modal-close {
        font-size: 1.75rem;
        width: 36px;
        height: 36px;
      }

      .modal-prev,
      .modal-next {
        font-size: 1.5rem;
        width: 44px;
        height: 44px;
        padding: 0.75rem;
      }

      .modal-prev {
        left: 0.5rem;
      }

      .modal-next {
        right: 0.5rem;
      }

      .modal-content {
        max-width: 95%;
        margin-top: 2.5rem;
      }

      .modal-content img {
        max-height: calc(100vh - 100px);
      }

      .modal-zoom-controls {
        bottom: 0.75rem;
        gap: 0.375rem;
      }

      .zoom-btn {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      .modal-header {
        padding: 0.625rem;
      }

      .modal-counter {
        font-size: 0.8125rem;
      }

      .modal-close {
        font-size: 1.5rem;
        width: 32px;
        height: 32px;
      }

      .modal-prev,
      .modal-next {
        font-size: 1.25rem;
        width: 40px;
        height: 40px;
        padding: 0.625rem;
      }

      .modal-prev {
        left: 0.25rem;
      }

      .modal-next {
        right: 0.25rem;
      }

      .modal-content {
        max-width: 98%;
        margin-top: 2rem;
      }

      .modal-content img {
        max-height: calc(100vh - 80px);
      }

      .modal-zoom-controls {
        bottom: 0.5rem;
        gap: 0.25rem;
      }

      .zoom-btn {
        width: 36px;
        height: 36px;
        font-size: 0.9375rem;
      }
    }

    /* Disable hover effects on touch devices */
    @media (hover: none) and (pointer: coarse) {
      .gallery-item:hover img {
        transform: none;
      }

      .gallery-item:hover .gallery-overlay {
        opacity: 0;
      }

      .tech-pill:hover {
        transform: none;
        background: linear-gradient(135deg, #c51d34 0%, #a01628 100%);
      }

      .timeline-card.highlighted {
        transform: none;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-layout project-detail-layout">
    <%- include('../partials/client-sidebar') %>

    <div class="project-content">
      <div class="project-hero">
        <div class="flying-tech-icons">
          <i class="fab fa-react" style="--i:1;"></i>
          <i class="fab fa-python" style="--i:2;"></i>
          <i class="fab fa-js-square" style="--i:3;"></i>
          <i class="fab fa-node-js" style="--i:4;"></i>
          <i class="fab fa-html5" style="--i:5;"></i>
          <i class="fab fa-css3-alt" style="--i:6;"></i>
          <i class="fab fa-vuejs" style="--i:7;"></i>
          <i class="fab fa-angular" style="--i:8;"></i>
          <i class="fab fa-java" style="--i:9;"></i>
          <i class="fab fa-php" style="--i:10;"></i>
          <i class="fab fa-laravel" style="--i:11;"></i>
          <i class="fab fa-swift" style="--i:12;"></i>
          <i class="fab fa-android" style="--i:13;"></i>
          <i class="fas fa-database" style="--i:16;"></i>
          <i class="fab fa-git-alt" style="--i:17;"></i>
          <i class="fab fa-github" style="--i:18;"></i>
          <i class="fab fa-npm" style="--i:19;"></i>
          <i class="fab fa-bootstrap" style="--i:20;"></i>
        </div>
        <div class="project-status-chip">
          <% const statusDotClass = timelineStats.progress === 100 ? 'complete' : 'in-progress' %>
          <% 
            const statusText = (project.status || timelineStats.status || 'In Progress').replace('_', ' ');
            const capitalizedStatus = statusText.charAt(0).toUpperCase() + statusText.slice(1).toLowerCase();
          %>
          <span class="status-dot <%= statusDotClass %>" style="width: 10px; height: 10px; border-radius: 50%; display: inline-block;"></span>
          <span><%= capitalizedStatus %></span>
        </div>
        <h1><%= project.title %></h1>
        <% if (project.description) { %>
          <p style="max-width: 60ch; color: rgba(17,24,39,0.8); font-size: 1rem; line-height: 1.6;">
            <%= project.description %>
          </p>
        <% } %>

        <div class="project-meta">
          <div class="project-meta-item service-meta-with-icon">
            <p style="margin: 0; opacity: 0.8; font-size: 0.85rem;">Service</p>
            <div class="service-title-wrapper">
              <% if (project.service_icon) { %>
                <div class="service-icon-display">
                  <% if (project.service_icon.startsWith('/')) { %>
                    <img src="<%= project.service_icon %>" alt="Service Icon" class="service-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <i class="fas fa-cog" style="display: none;"></i>
                  <% } else { %>
                    <i class="fas fa-<%= project.service_icon || 'cog' %>"></i>
                  <% } %>
                </div>
              <% } %>
              <strong style="font-size: 1.1rem;"><%= project.service_title || 'Custom Project' %></strong>
            </div>
          </div>
          <div class="project-meta-item">
            <p style="margin: 0; opacity: 0.8; font-size: 0.85rem;">Started</p>
            <strong><%= project.created_at ? new Date(project.created_at).toLocaleDateString() : 'â€”' %></strong>
          </div>
          <div class="project-meta-item">
            <p style="margin: 0; opacity: 0.8; font-size: 0.85rem;">Delivery</p>
            <strong><%= project.completed_at ? new Date(project.completed_at).toLocaleDateString() : 'In progress' %></strong>
          </div>
        </div>
      </div>

      <section class="project-grid-section">
        <div class="project-grid">
          <div class="project-card" style="grid-column: span 2;">
            <h3>Project Progress</h3>
            <div style="display:flex; align-items:center; gap:2rem; flex-wrap:wrap;">
              <div class="progress-ring">
                <svg width="140" height="140">
                  <circle cx="70" cy="70" r="62" stroke="#e5e7eb" stroke-width="12" fill="none"/>
                  <circle cx="70" cy="70" r="62" stroke="url(#progressGradient)" stroke-width="12" stroke-linecap="round" fill="none"
                    stroke-dasharray="<%= 2 * Math.PI * 62 %>"
                    stroke-dashoffset="<%= (1 - timelineStats.progress / 100) * 2 * Math.PI * 62 %>"/>
                  <defs>
                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" stop-color="#c51d34"/>
                      <stop offset="100%" stop-color="#f97316"/>
                    </linearGradient>
                  </defs>
                </svg>
                <div class="progress-ring-value"><%= timelineStats.progress %>%</div>
              </div>
              <div style="flex:1; min-width:260px;">
                <p style="margin-bottom:0.5rem; color:#6b7280;">Milestones</p>
                <h2 style="margin:0; font-size:2rem;"><%= timelineStats.totalMilestones %></h2>
                <div style="display:flex; gap:1.5rem; margin-top:1rem;">
                  <div>
                    <p style="margin:0; color:#6b7280;">Tasks</p>
                    <strong><%= timelineStats.completedTasks %> / <%= timelineStats.totalTasks %></strong>
                  </div>
                  <div>
                    <p style="margin:0; color:#6b7280;">Status</p>
                    <strong style="text-transform: capitalize;"><%= (project.status || timelineStats.status || 'in_progress').replace('_',' ') %></strong>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="project-card">
            <h3>Project Links</h3>
            <div style="display:flex; flex-direction:column; gap:0.75rem;">
              <% if (project.project_url) { %>
                <a href="<%= project.project_url %>" target="_blank" rel="noopener" class="btn btn-primary" style="display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                  <i class="fas fa-link"></i> Visit Live Project
                </a>
              <% } else { %>
                <p style="color:#9ca3af;">No public link available yet.</p>
              <% } %>
              <% if (project.video_url) { %>
                <a href="<%= project.video_url %>" target="_blank" rel="noopener" class="btn btn-secondary" style="display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                  <i class="fas fa-play-circle"></i> Watch Demo
                </a>
              <% } %>
              <% if (project.links && project.links.length > 0) { %>
                <% project.links.forEach(link => { %>
                  <a href="<%= link.url %>" target="_blank" rel="noopener" class="btn btn-secondary" style="display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                    <i class="fas fa-external-link-alt"></i> <%= link.title %>
                  </a>
                <% }) %>
              <% } %>
            </div>
          </div>

          <div class="project-card">
            <h3>Technologies</h3>
            <div>
              <% if (project.technologies && project.technologies.length) { %>
                <% 

                  function getTechIcon(tech) {
                    const iconMap = {
                      'PHP': 'devicon-php-plain',
                      'Laravel': 'devicon-laravel-plain',
                      'Vue': 'devicon-vuejs-plain',
                      'Vue.js': 'devicon-vuejs-plain',
                      'React': 'devicon-react-original',
                      'React Native': 'devicon-react-original',
                      'TypeScript': 'devicon-typescript-plain',
                      'JavaScript': 'devicon-javascript-plain',
                      'Livewire': 'devicon-livewire-plain-wordmark',
                      'Supabase': 'devicon-supabase-plain',
                      'EJS': 'fas fa-file-code',
                      'MySQL': 'devicon-mysql-plain',
                      'jQuery': 'devicon-jquery-plain',
                      'Premire Pro': 'devicon-premierepro-plain',
                      'PostgreSQL': 'devicon-postgresql-plain',
                      'Google Workspace': 'fab fa-google',
                      'Node.js': 'fab fa-node-js',
                      'Node': 'fab fa-node-js',
                      'Bootstrap': 'devicon-bootstrap-plain',
                      'Express.js': 'devicon-express-original',
                      'Express': 'devicon-express-original',
                      'HTML': 'devicon-html5-plain',
                      'HTML5': 'devicon-html5-plain',
                      'CSS': 'devicon-css3-plain',
                      'CSS3': 'devicon-css3-plain',
                      'Python': 'devicon-python-plain',
                      'Django': 'devicon-django-plain',
                      'Flask': 'devicon-flask-original',
                      'MongoDB': 'devicon-mongodb-plain',
                      'Git': 'devicon-git-plain',
                      'Docker': 'devicon-docker-plain',
                      'AWS': 'devicon-amazonwebservices-plain-wordmark',
                      'Firebase': 'devicon-firebase-plain',
                      'Next.js': 'devicon-nextjs-plain',
                      'Next': 'devicon-nextjs-plain',
                      'Tailwind CSS': 'devicon-tailwindcss-plain',
                      'Tailwind': 'devicon-tailwindcss-plain',
                      'Redux': 'devicon-redux-original',
                      'GraphQL': 'devicon-graphql-plain',
                      'Sass': 'devicon-sass-original',
                      'SCSS': 'devicon-sass-original',
                      'Webpack': 'devicon-webpack-plain',
                      'Figma': 'devicon-figma-plain',
                      'Java': 'devicon-java-plain',
                      'Spring': 'devicon-spring-plain',
                      'C++': 'devicon-cplusplus-plain',
                      'C#': 'devicon-csharp-plain',
                      'Go': 'devicon-go-plain',
                      'Ruby': 'devicon-ruby-plain',
                      'Rails': 'devicon-rails-plain',
                      'Angular': 'devicon-angularjs-plain',
                      'Svelte': 'devicon-svelte-plain'
                    };
                    return iconMap[tech] || 'fas fa-code';
                  }
                %>
                <% project.technologies.forEach(tech => { %>
                  <span class="tech-pill">
                    <i class="<%= getTechIcon(tech) %>"></i>
                    <span><%= tech %></span>
                  </span>
                <% }) %>
              <% } else { %>
                <p style="color:#9ca3af;">Technologies are being finalized.</p>
              <% } %>
            </div>
          </div>
        </div>
      </section>

      <% if ((project.cover_image_path && !project.cover_image_path.includes('We will work on that.png')) || (project.images && project.images.length > 0)) { %>
        <section style="margin-top:3rem;">
          <% if (project.cover_image_path && !project.cover_image_path.includes('We will work on that.png')) { %>
            <div class="project-card" style="padding:0; overflow:hidden;">
              <img src="<%= project.cover_image_path %>" alt="<%= project.title %>" class="cover-image-clickable" style="width:100%; max-height:420px; object-fit:cover; cursor:pointer;">
            </div>
          <% } %>
          <% if (project.images && project.images.length > 1) { %>
            <div class="project-gallery">
              <% project.images.slice(1).forEach((image, index) => { %>
                <div class="gallery-item gallery-link" data-image="<%= image %>" data-index="<%= index + 1 %>">
                  <img src="<%= image %>" alt="<%= project.title %> Image <%= index + 2 %>" loading="lazy">
                  <div class="gallery-overlay">
                    <i class="fas fa-expand"></i>
                  </div>
                </div>
              <% }) %>
            </div>
          <% } %>
        </section>
      <% } %>

      <section class="timeline-wrapper">
        <div class="timeline-header">
          <div>
            <h2 style="margin:0;">Milestone Timeline</h2>
            <p style="margin:0.35rem 0 0; color:#6b7280;">Track each phase and its deliverables</p>
          </div>
        </div>

        <% 
          let highlightedMilestoneIndex = null;
          if (project.milestones && project.milestones.length > 0) {
            const now = Date.now();
            let smallestDiff = Infinity;
            project.milestones.forEach((milestone, idx) => {
              if (!milestone.date) {
                return;
              }
              const diff = Math.abs(new Date(milestone.date).getTime() - now);
              if (diff < smallestDiff) {
                smallestDiff = diff;
                highlightedMilestoneIndex = idx;
              }
            });
          }
        %>

        <% if (project.milestones && project.milestones.length > 0) { %>
          <div class="timeline">
            <% project.milestones.forEach((milestone, index) => { %>
              <div class="timeline-card <%= milestone.status === 'Completed' ? 'completed' : '' %> <%= highlightedMilestoneIndex === index ? 'highlighted' : '' %>">
                <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:1rem; flex-wrap:wrap;">
                  <div>
                    <h4><%= milestone.title %></h4>
                    <div class="timeline-meta">
                      <span><i class="fas fa-layer-group"></i> Phase <%= index + 1 %></span>
                      <% if (milestone.date) { %>
                        <span><i class="fas fa-calendar"></i> <%= new Date(milestone.date).toLocaleDateString() %></span>
                      <% } %>
                      <span><i class="fas fa-flag-checkered"></i> <%= milestone.status || 'Not Started' %></span>
                    </div>
                  </div>
                  <span style="font-weight:600; color:#c51d34;"><%= milestone.progress %>%</span>
                </div>
                <div class="milestone-progress" style="--progress:<%= milestone.progress %>%;">
                  <div class="milestone-progress-fill"></div>
                </div>
                <% if (milestone.tasks && milestone.tasks.length > 0) { %>
                  <div class="tasks-list">
                    <% milestone.tasks.forEach(task => { %>
                      <div class="task-item <%= task.is_completed ? 'completed' : '' %>">
                        <i class="fas <%= task.is_completed ? 'fa-check-circle' : 'fa-circle-notch' %> task-icon"></i>
                        <div>
                          <strong><%= task.title %></strong>
                          <% if (task.description) { %>
                            <p><%= task.description %></p>
                          <% } %>
                        </div>
                      </div>
                    <% }) %>
                  </div>
                <% } else { %>
                  <p style="margin:0; color:#9ca3af;">Tasks for this milestone are being defined.</p>
                <% } %>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <div class="empty-state">
            <i class="fas fa-stream" style="font-size:3rem; color:#c51d34; margin-bottom:1rem;"></i>
            <h3>Timeline coming soon</h3>
            <p>Your project executive will publish the milestone plan shortly. Stay tuned!</p>
          </div>
        <% } %>
      </section>
    </div>
  </div>

  <!-- Image Lightbox Modal -->
  <div id="imageModal" class="image-modal">
    <div class="modal-header">
      <div class="modal-counter"></div>
      <span class="modal-close">&times;</span>
    </div>
    <span class="modal-prev"><i class="fas fa-chevron-left"></i></span>
    <span class="modal-next"><i class="fas fa-chevron-right"></i></span>
    <div class="modal-content">
      <img id="modalImage" src="" alt="Project Image">
      <div class="modal-zoom-controls">
        <button class="zoom-btn" id="zoomIn"><i class="fas fa-search-plus"></i></button>
        <button class="zoom-btn" id="zoomOut"><i class="fas fa-search-minus"></i></button>
        <button class="zoom-btn" id="zoomReset"><i class="fas fa-compress"></i></button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

      function updateProgressRing() {
        const progressRing = document.querySelector('.progress-ring');
        if (!progressRing) return;

        const svg = progressRing.querySelector('svg');
        const circles = svg.querySelectorAll('circle');
        if (!svg || !circles.length) return;

        const progress = <%= timelineStats.progress %>;
        let size, radius, cx, cy, strokeWidth;

        if (window.innerWidth <= 480) {
          size = 100;
          radius = 44;
          cx = cy = 50;
          strokeWidth = 8;
        } else if (window.innerWidth <= 768) {
          size = 120;
          radius = 52;
          cx = cy = 60;
          strokeWidth = 10;
        } else {
          size = 140;
          radius = 62;
          cx = cy = 70;
          strokeWidth = 12;
        }

        svg.setAttribute('width', size);
        svg.setAttribute('height', size);
        svg.setAttribute('viewBox', `0 0 ${size} ${size}`);

        circles.forEach(circle => {
          circle.setAttribute('cx', cx);
          circle.setAttribute('cy', cy);
          circle.setAttribute('r', radius);
          circle.setAttribute('stroke-width', strokeWidth);
        });


        const progressCircle = circles[1];
        if (progressCircle) {
          const circumference = 2 * Math.PI * radius;
          progressCircle.setAttribute('stroke-dasharray', circumference);
          progressCircle.setAttribute('stroke-dashoffset', (1 - progress / 100) * circumference);
        }
      }


      updateProgressRing();
      window.addEventListener('resize', updateProgressRing);

      const sections = document.querySelectorAll('.project-content section');

      if (!sections.length) {
        return;
      }

      if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries, obs) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
              obs.unobserve(entry.target);
            }
          });
        }, { threshold: 0.15, rootMargin: '0px 0px -40px 0px' });

        sections.forEach(section => observer.observe(section));
      } else {
        sections.forEach(section => section.classList.add('visible'));
      }


      const modal = document.getElementById('imageModal');
      const modalImg = document.getElementById('modalImage');
      const modalClose = document.querySelector('.modal-close');
      const modalPrev = document.querySelector('.modal-prev');
      const modalNext = document.querySelector('.modal-next');
      const modalCounter = document.querySelector('.modal-counter');
      const zoomInBtn = document.getElementById('zoomIn');
      const zoomOutBtn = document.getElementById('zoomOut');
      const zoomResetBtn = document.getElementById('zoomReset');
      
      let currentImageIndex = 0;
      let images = [];
      let zoomLevel = 1;


      const coverImage = document.querySelector('.cover-image-clickable');
      
      document.querySelectorAll('.gallery-link').forEach((link, index) => {
        link.addEventListener('click', (e) => {
          e.preventDefault();

          images = [];
          if (coverImage) {
            images.push(coverImage.src);
          }
          images = images.concat(Array.from(document.querySelectorAll('.gallery-link')).map(l => l.getAttribute('data-image')));
          currentImageIndex = coverImage ? parseInt(link.getAttribute('data-index')) + 1 : parseInt(link.getAttribute('data-index'));
          openModal(currentImageIndex);
        });
      });


      if (coverImage) {
        coverImage.addEventListener('click', () => {
          images = [coverImage.src];
          if (document.querySelectorAll('.gallery-link').length > 0) {
            images = images.concat(Array.from(document.querySelectorAll('.gallery-link')).map(l => l.getAttribute('data-image')));
          }
          currentImageIndex = 0;
          openModal(0);
        });
      }

      function openModal(index) {
        currentImageIndex = index;
        modalImg.src = images[index];
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        zoomLevel = 1;
        updateZoom();
        updateCounter();
      }

      function closeModal() {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        zoomLevel = 1;
        updateZoom();
      }

      function nextImage() {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        modalImg.src = images[currentImageIndex];
        zoomLevel = 1;
        updateZoom();
        updateCounter();
      }

      function prevImage() {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        modalImg.src = images[currentImageIndex];
        zoomLevel = 1;
        updateZoom();
        updateCounter();
      }

      function updateCounter() {
        modalCounter.textContent = `${currentImageIndex + 1} / ${images.length}`;
      }

      function updateZoom() {
        modalImg.style.transform = `scale(${zoomLevel})`;
      }

      function zoomIn() {
        if (zoomLevel < 3) {
          zoomLevel += 0.25;
          updateZoom();
        }
      }

      function zoomOut() {
        if (zoomLevel > 0.5) {
          zoomLevel -= 0.25;
          updateZoom();
        }
      }

      function resetZoom() {
        zoomLevel = 1;
        updateZoom();
      }


      if (modalClose) modalClose.addEventListener('click', closeModal);
      if (modalPrev) modalPrev.addEventListener('click', prevImage);
      if (modalNext) modalNext.addEventListener('click', nextImage);
      if (zoomInBtn) zoomInBtn.addEventListener('click', zoomIn);
      if (zoomOutBtn) zoomOutBtn.addEventListener('click', zoomOut);
      if (zoomResetBtn) zoomResetBtn.addEventListener('click', resetZoom);


      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            closeModal();
          }
        });
      }


      document.addEventListener('keydown', (e) => {
        if (modal && modal.style.display === 'flex') {
          if (e.key === 'Escape') closeModal();
          if (e.key === 'ArrowRight') nextImage();
          if (e.key === 'ArrowLeft') prevImage();
          if (e.key === '+' || e.key === '=') zoomIn();
          if (e.key === '-') zoomOut();
          if (e.key === '0') resetZoom();
        }
      });


      if (modalImg) {
        modalImg.addEventListener('wheel', (e) => {
          e.preventDefault();
          if (e.deltaY < 0) {
            zoomIn();
          } else {
            zoomOut();
          }
        });
      }


      let touchStartX = 0;
      let touchEndX = 0;
      let touchStartY = 0;
      let touchEndY = 0;
      const swipeThreshold = 50;

      if (modal) {
        modal.addEventListener('touchstart', (e) => {
          touchStartX = e.changedTouches[0].screenX;
          touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        modal.addEventListener('touchend', (e) => {
          touchEndX = e.changedTouches[0].screenX;
          touchEndY = e.changedTouches[0].screenY;
          handleSwipe();
        }, { passive: true });
      }

      function handleSwipe() {
        const swipeDistanceX = touchEndX - touchStartX;
        const swipeDistanceY = touchEndY - touchStartY;
        
        if (Math.abs(swipeDistanceX) > Math.abs(swipeDistanceY)) {
          if (Math.abs(swipeDistanceX) > swipeThreshold) {
            if (swipeDistanceX > 0) {
              prevImage();
            } else {
              nextImage();
            }
          }
        }
      }


      const modalContent = document.querySelector('.modal-content');
      if (modalContent) {
        modalContent.addEventListener('touchmove', (e) => {
          if (zoomLevel === 1) {
            e.preventDefault();
          }
        }, { passive: false });
      }
    });
  </script>

  <!-- White Image to Red Converter Script -->
  <script>
    function checkImageBrightness(img) {
      return new Promise((resolve) => {

        if (img.dataset.processed === 'true') {
          resolve(false);
          return;
        }
        

        if (!img.complete || img.naturalWidth === 0 || img.naturalHeight === 0) {
          const checkLoaded = () => {
            if (img.complete && img.naturalWidth > 0 && img.naturalHeight > 0) {
              analyzeImage(img).then(resolve);
            } else {
              setTimeout(checkLoaded, 100);
            }
          };
          checkLoaded();
          return;
        }
        
        analyzeImage(img).then(resolve);
      });
    }
    
    function analyzeImage(img) {
      return new Promise((resolve) => {
        try {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = img.naturalWidth || img.width;
          canvas.height = img.naturalHeight || img.height;
          
          if (canvas.width === 0 || canvas.height === 0) {
            img.dataset.processed = 'true';
            resolve(false);
            return;
          }
          
          ctx.drawImage(img, 0, 0);
          

          const samplePoints = [];
          const gridSize = 5; 
          
          for (let i = 0; i <= gridSize; i++) {
            for (let j = 0; j <= gridSize; j++) {
              samplePoints.push({
                x: (i / gridSize) * canvas.width,
                y: (j / gridSize) * canvas.height
              });
            }
          }
          
          let totalBrightness = 0;
          let sampleCount = 0;
          let whitePixelCount = 0;
          
          samplePoints.forEach(point => {
            const x = Math.floor(point.x);
            const y = Math.floor(point.y);
            
            if (x >= 0 && x < canvas.width && y >= 0 && y < canvas.height) {
              try {
                const pixelData = ctx.getImageData(x, y, 1, 1).data;
                const r = pixelData[0];
                const g = pixelData[1];
                const b = pixelData[2];
                const a = pixelData[3];
                

                if (a < 128) return;
                

                const brightness = (r + g + b) / 3;
                totalBrightness += brightness;
                sampleCount++;
                

                if (brightness > 200) {
                  whitePixelCount++;
                }
              } catch (e) {

              }
            }
          });
          
          if (sampleCount === 0) {
            img.dataset.processed = 'true';
            resolve(false);
            return;
          }
          
          const averageBrightness = totalBrightness / sampleCount;
          const whitePixelRatio = whitePixelCount / sampleCount;
          



          const shouldConvert = averageBrightness > 200 || whitePixelRatio > 0.8;
          
          if (shouldConvert) {

            img.style.filter = 'brightness(0) saturate(100%) invert(27%) sepia(89%) saturate(1352%) hue-rotate(330deg) brightness(89%) contrast(87%)';
            img.style.transition = 'filter 0.3s ease';
          }
          
          img.dataset.processed = 'true';
          resolve(shouldConvert);
        } catch (e) {
          console.warn('Error analyzing image:', e);
          img.dataset.processed = 'true';
          resolve(false);
        }
      });
    }
    
    function processAllImages() {
      const serviceImages = document.querySelectorAll('.service-icon-img:not([data-processed="true"])');
      
      if (serviceImages.length === 0) return;
      
      serviceImages.forEach(img => {
        checkImageBrightness(img);
      });
    }
    

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {

        setTimeout(processAllImages, 100);
        

        setTimeout(processAllImages, 1000);
        setTimeout(processAllImages, 2000);
        

        const observer = new MutationObserver(processAllImages);
        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
      });
    } else {

      setTimeout(processAllImages, 100);
      setTimeout(processAllImages, 1000);
      setTimeout(processAllImages, 2000);
    }
    

    document.addEventListener('load', function(e) {
      if (e.target.classList && e.target.classList.contains('service-icon-img')) {
        checkImageBrightness(e.target);
      }
    }, true);
  </script>
</body>
</html>

