<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <!-- Devicon CSS for tech icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css">
  <style>
    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .dashboard-layout {
      display: flex;
      min-height: 100vh;
    }

    .dashboard-main {
      flex: 1;
      padding: 2rem 2.5rem;
      margin-left: 280px;
      background: #f9fafb;
    }

    .page-header {
      margin-bottom: 2rem;
      animation: fadeInUp 0.6s ease-out 0.1s both;
    }

    .page-header h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #111827;
      margin-bottom: 0.5rem;
    }

    .page-header p {
      color: #6b7280;
      font-size: 0.9375rem;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      color: #6b7280;
      font-size: 0.875rem;
      animation: fadeIn 0.5s ease-out;
    }

    .breadcrumb a {
      color: #c51d34;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .user-info-card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      display: flex;
      align-items: center;
      gap: 1rem;
      animation: fadeInUp 0.6s ease-out 0.2s both;
    }

    .user-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
    }

    .user-details h3 {
      font-size: 1.125rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.25rem;
    }

    .user-details p {
      color: #6b7280;
      font-size: 0.875rem;
    }

    .form-container {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
      animation: fadeInUp 0.6s ease-out 0.3s both;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
      animation: fadeInUp 0.5s ease-out both;
    }

    /* Stagger animation for form groups */
    .form-group:nth-child(1) { animation-delay: 0.4s; }
    .form-group:nth-child(2) { animation-delay: 0.45s; }
    .form-group:nth-child(3) { animation-delay: 0.5s; }
    .form-group:nth-child(4) { animation-delay: 0.55s; }
    .form-group:nth-child(5) { animation-delay: 0.6s; }
    .form-group:nth-child(6) { animation-delay: 0.65s; }
    .form-group:nth-child(7) { animation-delay: 0.7s; }
    .form-group:nth-child(8) { animation-delay: 0.75s; }
    .form-group:nth-child(9) { animation-delay: 0.8s; }
    .form-group:nth-child(10) { animation-delay: 0.85s; }
    .form-group:nth-child(11) { animation-delay: 0.9s; }
    .form-group:nth-child(12) { animation-delay: 0.95s; }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-container .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #111827 !important;
      opacity: 1 !important;
    }

    .form-container .form-group label .required {
      color: #c51d34;
    }

    /* Force visibility and proper styling of form inputs */
    .form-container .form-control,
    .form-container input.form-control,
    .form-container select.form-control,
    .form-container textarea.form-control {
      width: 100% !important;
      padding: 0.75rem !important;
      border: 2px solid #e5e7eb !important;
      border-radius: 6px !important;
      font-size: 0.875rem !important;
      font-family: inherit !important;
      background: #ffffff !important;
      color: #111827 !important;
      box-sizing: border-box !important;
      transition: all 0.2s ease !important;
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
    }

    .form-container .form-control:focus,
    .form-container input.form-control:focus,
    .form-container select.form-control:focus,
    .form-container textarea.form-control:focus {
      outline: none !important;
      border-color: #c51d34 !important;
      box-shadow: 0 0 0 3px rgba(197, 29, 52, 0.1) !important;
      transform: none !important;
      opacity: 1 !important;
    }

    textarea.form-control {
      min-height: 120px !important;
      resize: vertical !important;
    }

    .form-help {
      display: block;
      margin-top: 0.25rem;
      font-size: 0.8125rem;
      color: #6b7280;
      opacity: 1 !important;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto !important;
      cursor: pointer;
      display: inline-block !important;
    }

    .form-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid #e5e7eb;
      animation: fadeInUp 0.5s ease-out 1s both;
      z-index: 1;
    }

    .form-container .btn {
      padding: 0.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      font-size: 0.875rem;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      opacity: 1 !important;
      width: 40px;
      height: 40px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .form-container .btn-primary {
      background: linear-gradient(135deg, #c51d34 0%, #a01628 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(197, 29, 52, 0.3);
    }

    .form-container .btn-primary:hover {
      background: linear-gradient(135deg, #a01628 0%, #8a1323 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(197, 29, 52, 0.4);
    }

    .form-container .btn-secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }

    .form-container .btn-secondary:hover {
      background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
    }

    .form-container .btn-submit {
      background: linear-gradient(135deg, #c51d34 0%, #a01628 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(197, 29, 52, 0.3);
      width: auto;
      padding: 0.75rem 1.5rem;
    }

    .form-container .btn-submit:hover {
      background: linear-gradient(135deg, #a01628 0%, #8a1323 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(197, 29, 52, 0.4);
    }

    /* Hover effects */
    .form-container .form-control:hover {
      border-color: #d1d5db;
    }

    .user-avatar {
      transition: transform 0.3s ease;
    }

    .user-info-card:hover .user-avatar {
      transform: scale(1.05);
    }

    /* Loading state */
    .form-container .btn-primary:active {
      transform: scale(0.98);
    }

    /* Avatar Upload Styles */
    .avatar-upload-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .avatar-preview {
      position: relative;
      width: 150px;
      height: 150px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid #e5e7eb;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .avatar-preview:hover {
      border-color: #c51d34;
      transform: scale(1.05);
    }

    /* Drag and Drop States */
    .avatar-preview.drag-over {
      border-color: #c51d34;
      border-width: 4px;
      transform: scale(1.1);
      box-shadow: 0 0 0 4px rgba(197, 29, 52, 0.2);
    }

    .avatar-preview.drag-over .avatar-upload-overlay {
      opacity: 1;
      background: rgba(197, 29, 52, 0.95);
    }

    .avatar-preview.drag-over .avatar-upload-overlay i {
      transform: scale(1.2);
      animation: dragPulse 1s ease-in-out infinite;
    }

    @keyframes dragPulse {
      0%, 100% {
        transform: scale(1.2);
      }
      50% {
        transform: scale(1.4);
      }
    }

    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-upload-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(197, 29, 52, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      color: white;
      gap: 0.5rem;
    }

    .avatar-preview:hover .avatar-upload-overlay {
      opacity: 1;
    }

    .avatar-upload-overlay i {
      font-size: 2rem;
    }

    .avatar-upload-overlay span {
      font-size: 0.875rem;
      font-weight: 600;
    }

    .avatar-input {
      display: none;
    }

    /* Select2 Custom Styling */
    .select2-container--default .select2-selection--multiple {
      border: 2px solid #e5e7eb !important;
      border-radius: 8px !important;
      min-height: 52px !important;
      padding: 0.375rem 0.75rem !important;
      background: #ffffff !important;
      transition: all 0.2s ease !important;
    }

    .select2-container--default.select2-container--focus .select2-selection--multiple {
      border-color: #c51d34 !important;
      box-shadow: 0 0 0 3px rgba(197, 29, 52, 0.1) !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice {
      background: linear-gradient(135deg, #c51d34 0%, #a01628 100%) !important;
      border: none !important;
      color: white !important;
      padding: 0.5rem 0.75rem 0.5rem 1rem !important;
      border-radius: 20px !important;
      margin: 0.375rem 0.375rem 0.375rem 0 !important;
      font-size: 0.875rem !important;
      font-weight: 600 !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      box-shadow: 0 2px 8px rgba(197, 29, 52, 0.25), 0 1px 3px rgba(0, 0, 0, 0.1) !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      cursor: default !important;
      position: relative !important;
      overflow: hidden !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice:hover {
      background: linear-gradient(135deg, #a01628 0%, #8a1323 100%) !important;
      transform: translateY(-2px) scale(1.02) !important;
      box-shadow: 0 4px 12px rgba(197, 29, 52, 0.35), 0 2px 6px rgba(0, 0, 0, 0.15) !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice:hover::before {
      left: 100%;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
      color: transparent !important;
      margin-right: 0 !important;
      font-weight: 700 !important;
      font-size: 0 !important;
      width: 20px !important;
      height: 20px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      border-radius: 50% !important;
      background: rgba(255, 255, 255, 0.25) !important;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
      cursor: pointer !important;
      line-height: 1 !important;
      padding: 0 !important;
      opacity: 1 !important;
      flex-shrink: 0 !important;
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
      position: relative !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove::before {
      content: 'Ã—' !important;
      display: block !important;
      font-size: 1.25rem !important;
      line-height: 1 !important;
      font-weight: 300 !important;
      color: white !important;
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
      background: rgba(255, 255, 255, 0.95) !important;
      border-color: rgba(255, 255, 255, 0.5) !important;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25) !important;
      transform: scale(1.15) !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover::before {
      color: #c51d34 !important;
      transform: translate(-50%, -50%) rotate(90deg) !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:active {
      transform: scale(1.05) !important;
      background: rgba(255, 255, 255, 0.85) !important;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:active::before {
      transform: translate(-50%, -50%) rotate(90deg) !important;
    }

    .select2-container--default .select2-results__option--highlighted[aria-selected] {
      background-color: #c51d34 !important;
      color: white !important;
    }

    .select2-container--default .select2-results__option[aria-selected=true] {
      background-color: #f3f4f6 !important;
      color: #6b7280 !important;
    }

    .select2-container {
      width: 100% !important;
    }

    .select2-dropdown {
      border: 2px solid #e5e7eb !important;
      border-radius: 8px !important;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
      margin-top: 4px !important;
    }

    .select2-results__options {
      max-height: 280px !important;
      overflow-y: auto !important;
    }

    .select2-results__option {
      padding: 0.625rem 1rem !important;
      display: flex !important;
      align-items: center !important;
      gap: 0.75rem !important;
      font-size: 0.875rem !important;
      transition: all 0.15s ease !important;
    }

    .select2-results__option i {
      font-size: 1.25rem !important;
      width: 24px !important;
      text-align: center !important;
    }

    .select2-search--dropdown {
      padding: 0.75rem !important;
      background: #f9fafb !important;
      border-bottom: 1px solid #e5e7eb !important;
    }

    .select2-search--dropdown .select2-search__field {
      border: 2px solid #e5e7eb !important;
      border-radius: 6px !important;
      padding: 0.625rem 1rem !important;
      font-size: 0.875rem !important;
      background: white !important;
      transition: all 0.2s ease !important;
    }

    .select2-search--dropdown .select2-search__field:focus {
      border-color: #c51d34 !important;
      outline: none !important;
      box-shadow: 0 0 0 3px rgba(197, 29, 52, 0.1) !important;
    }

    /* Custom scrollbar for dropdown */
    .select2-results__options::-webkit-scrollbar {
      width: 8px;
    }

    .select2-results__options::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .select2-results__options::-webkit-scrollbar-thumb {
      background: #c51d34;
      border-radius: 10px;
    }

    .select2-results__options::-webkit-scrollbar-thumb:hover {
      background: #a01628;
    }

    /* Success Modal */
    .success-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .success-modal.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content-wrapper {
      background: white;
      border-radius: 16px;
      padding: 2.5rem;
      max-width: 480px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: scale(0.8);
      transition: transform 0.3s ease;
      text-align: center;
    }

    .success-modal.show .modal-content-wrapper {
      transform: scale(1);
    }

    .modal-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      animation: successPulse 0.6s ease-out;
    }

    .modal-icon i {
      color: white;
      font-size: 2.5rem;
    }

    @keyframes successPulse {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #111827;
      margin-bottom: 0.75rem;
    }

    .modal-message {
      color: #6b7280;
      font-size: 1rem;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .modal-btn {
      padding: 0.75rem 2rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      font-size: 0.9375rem;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .modal-btn-primary {
      background: linear-gradient(135deg, #c51d34 0%, #a01628 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(197, 29, 52, 0.3);
    }

    .modal-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(197, 29, 52, 0.4);
    }

    .modal-btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .modal-btn-secondary:hover {
      background: #e5e7eb;
    }

    @media (max-width: 768px) {
      .dashboard-main {
        margin-left: 0;
        padding: 1rem;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .avatar-preview {
        width: 120px;
        height: 120px;
      }

      .avatar-upload-overlay i {
        font-size: 1.5rem;
      }

      .avatar-upload-overlay span {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-layout">
    <%- include('../partials/admin-sidebar') %>
    
    <div class="dashboard-main">
      <div class="breadcrumb">
        <a href="/admin/dashboard">Dashboard</a>
        <i class="fas fa-chevron-right"></i>
        <a href="/admin/team">Team</a>
        <i class="fas fa-chevron-right"></i>
        <span><%= isEdit ? 'Edit' : 'Add' %> Team Member</span>
      </div>

      <div class="page-header">
        <h1><%= isEdit ? 'Edit' : 'Add' %> Team Member</h1>
        <p><%= isEdit ? 'Update team member profile information' : 'Create a new team member profile' %></p>
      </div>

      <% if (isEdit) { %>
      <div class="user-info-card">
        <img src="<%= member.avatar || '/images/default-avatar.webp' %>" alt="<%= member.name %>" class="user-avatar" id="currentAvatar">
        <div class="user-details">
          <h3><%= member.name %></h3>
          <p><%= member.email %></p>
        </div>
      </div>
      <% } %>

      <div class="form-container">
        <form method="POST" action="<%= isEdit ? `/admin/team/${member.id}` : '/admin/team/add' %>" enctype="multipart/form-data" id="teamForm">
          <div class="form-grid">
            <% if (!isEdit) { %>
            <!-- Avatar Upload Section -->
            <div class="form-group full-width">
              <label for="avatar">Profile Picture</label>
              <div class="avatar-upload-container">
                <div class="avatar-preview" id="avatarPreview">
                  <img src="/images/default-avatar.webp" alt="Preview" id="avatarPreviewImg">
                  <div class="avatar-upload-overlay">
                    <i class="fas fa-camera"></i>
                    <span>Choose Photo</span>
                  </div>
                </div>
                <input type="file" id="avatar" name="profilePicture" class="avatar-input" accept="image/*">
              </div>
              <small class="form-help">Upload a profile picture (optional, max 5MB, will be converted to WebP). You can drag and drop an image here or click to browse.</small>
            </div>

            <!-- Name and Email -->
            <div class="form-group">
              <label for="name">Name <span class="required">*</span></label>
              <input type="text" id="name" name="name" class="form-control" required placeholder="John Doe">
            </div>

            <div class="form-group">
              <label for="email">Email <span class="required">*</span></label>
              <input type="email" id="email" name="email" class="form-control" required placeholder="john@example.com">
            </div>

            <!-- Role Selection -->
            <div class="form-group full-width">
              <label for="role">Role <span class="required">*</span></label>
              <select id="role" name="role" class="form-control" required>
                <option value="team_member">Team Member</option>
                <option value="admin">Admin</option>
              </select>
              <small class="form-help">Choose the user's role in the system</small>
            </div>
            <% } else { %>
            <!-- Edit Mode: Avatar Upload Section -->
            <div class="form-group full-width">
              <label for="avatar">Profile Picture</label>
              <div class="avatar-upload-container">
                <div class="avatar-preview" id="avatarPreview">
                  <img src="<%= member.avatar || '/images/default-avatar.webp' %>" alt="Preview" id="avatarPreviewImg">
                  <div class="avatar-upload-overlay">
                    <i class="fas fa-camera"></i>
                    <span>Change Photo</span>
                  </div>
                </div>
                <input type="file" id="avatar" name="profilePicture" class="avatar-input" accept="image/*">
              </div>
              <small class="form-help">Upload a new profile picture (optional, max 5MB, will be converted to WebP). You can drag and drop an image here or click to browse. Leave empty to keep current picture.</small>
            </div>

            <!-- Edit Mode: Name -->
            <div class="form-group">
              <label for="name">Full Name <span class="required">*</span></label>
              <input type="text" id="name" name="name" class="form-control" required placeholder="John Doe" value="<%= member.name || '' %>">
            </div>

            <!-- Edit Mode: Email -->
            <div class="form-group">
              <label for="email">Email <span class="required">*</span></label>
              <input type="email" id="email" name="email" class="form-control" required placeholder="john@example.com" value="<%= member.email || '' %>">
            </div>

            <!-- Edit Mode: Role Selection -->
            <div class="form-group">
              <label for="role">Role <span class="required">*</span></label>
              <select id="role" name="role" class="form-control" required>
                <option value="team_member" <%= member.role === 'team_member' ? 'selected' : '' %>>Team Member</option>
                <option value="admin" <%= member.role === 'admin' ? 'selected' : '' %>>Admin</option>
              </select>
              <small class="form-help">Choose the user's role in the system</small>
            </div>

            <!-- Edit Mode: Password -->
            <div class="form-group">
              <label for="password">New Password</label>
              <input type="password" id="password" name="password" class="form-control" placeholder="Leave empty to keep current password">
              <small class="form-help">Only enter a new password if you want to change it</small>
            </div>
            <% } %>

            <div class="form-group full-width">
              <label for="position">Position <span class="required">*</span></label>
              <input type="text" id="position" name="position" class="form-control" required placeholder="e.g., Full Stack Developer" value="<%= isEdit ? (member.position || '') : '' %>">
            </div>

            <div class="form-group full-width">
              <label for="bio">Bio</label>
              <textarea id="bio" name="bio" class="form-control" placeholder="Tell us about this team member..."><%= isEdit ? (member.bio || '') : '' %></textarea>
            </div>

            <div class="form-group full-width">
              <label for="skills">Skills</label>
              <% 
                let skillsArray = [];
                if (isEdit && member.skills) {
                  try {
                    skillsArray = Array.isArray(member.skills) ? member.skills : JSON.parse(member.skills);
                  } catch (e) {
                    skillsArray = [];
                  }
                }
              %>
              <select id="skills" name="skills" class="form-control skills-select" multiple="multiple">
                <option value="PHP" data-icon="devicon-php-plain" <%= skillsArray.includes('PHP') ? 'selected' : '' %>>PHP</option>
                <option value="Laravel" data-icon="devicon-laravel-plain" <%= skillsArray.includes('Laravel') ? 'selected' : '' %>>Laravel</option>
                <option value="Vue" data-icon="devicon-vuejs-plain" <%= skillsArray.includes('Vue') ? 'selected' : '' %>>Vue</option>
                <option value="React" data-icon="devicon-react-original" <%= skillsArray.includes('React') ? 'selected' : '' %>>React</option>
                <option value="React Native" data-icon="devicon-react-original" <%= skillsArray.includes('React Native') ? 'selected' : '' %>>React Native</option>
                <option value="TypeScript" data-icon="devicon-typescript-plain" <%= skillsArray.includes('TypeScript') ? 'selected' : '' %>>TypeScript</option>
                <option value="JavaScript" data-icon="devicon-javascript-plain" <%= skillsArray.includes('JavaScript') ? 'selected' : '' %>>JavaScript</option>
                <option value="Livewire" data-icon="devicon-livewire-plain-wordmark" <%= skillsArray.includes('Livewire') ? 'selected' : '' %>>Livewire</option>
                <option value="Supabase" data-icon="devicon-supabase-plain" <%= skillsArray.includes('Supabase') ? 'selected' : '' %>>Supabase</option>
                <option value="EJS" data-icon="fas fa-file-code" <%= skillsArray.includes('EJS') ? 'selected' : '' %>>EJS</option>
                <option value="MySQL" data-icon="devicon-mysql-plain" <%= skillsArray.includes('MySQL') ? 'selected' : '' %>>MySQL</option>
                <option value="jQuery" data-icon="devicon-jquery-plain" <%= skillsArray.includes('jQuery') ? 'selected' : '' %>>jQuery</option>
                <option value="Premire Pro" data-icon="devicon-premierepro-plain" <%= skillsArray.includes('Premire Pro') ? 'selected' : '' %>>Premire Pro</option>
                <option value="PostgreSQL" data-icon="devicon-postgresql-plain" <%= skillsArray.includes('PostgreSQL') ? 'selected' : '' %>>PostgreSQL</option>
                <option value="Google Workspace" data-icon="fab fa-google" <%= skillsArray.includes('Google Workspace') ? 'selected' : '' %>>Google Workspace</option>
                <option value="Node.js" data-icon="fab fa-node-js" <%= skillsArray.includes('Node.js') ? 'selected' : '' %>>Node.js</option>
                <option value="Bootstrap" data-icon="devicon-bootstrap-plain" <%= skillsArray.includes('Bootstrap') ? 'selected' : '' %>>Bootstrap</option>
                <option value="Express.js" data-icon="devicon-express-original" <%= skillsArray.includes('Express.js') ? 'selected' : '' %>>Express.js</option>
                <option value="HTML" data-icon="devicon-html5-plain" <%= skillsArray.includes('HTML') ? 'selected' : '' %>>HTML</option>
                <option value="CSS" data-icon="devicon-css3-plain" <%= skillsArray.includes('CSS') ? 'selected' : '' %>>CSS</option>
                <option value="Python" data-icon="devicon-python-plain" <%= skillsArray.includes('Python') ? 'selected' : '' %>>Python</option>
                <option value="Django" data-icon="devicon-django-plain" <%= skillsArray.includes('Django') ? 'selected' : '' %>>Django</option>
                <option value="Flask" data-icon="devicon-flask-original" <%= skillsArray.includes('Flask') ? 'selected' : '' %>>Flask</option>
                <option value="MongoDB" data-icon="devicon-mongodb-plain" <%= skillsArray.includes('MongoDB') ? 'selected' : '' %>>MongoDB</option>
                <option value="Git" data-icon="devicon-git-plain" <%= skillsArray.includes('Git') ? 'selected' : '' %>>Git</option>
                <option value="Docker" data-icon="devicon-docker-plain" <%= skillsArray.includes('Docker') ? 'selected' : '' %>>Docker</option>
                <option value="AWS" data-icon="devicon-amazonwebservices-plain-wordmark" <%= skillsArray.includes('AWS') ? 'selected' : '' %>>AWS</option>
                <option value="Firebase" data-icon="devicon-firebase-plain" <%= skillsArray.includes('Firebase') ? 'selected' : '' %>>Firebase</option>
                <option value="Next.js" data-icon="devicon-nextjs-plain" <%= skillsArray.includes('Next.js') ? 'selected' : '' %>>Next.js</option>
                <option value="Tailwind CSS" data-icon="devicon-tailwindcss-plain" <%= skillsArray.includes('Tailwind CSS') ? 'selected' : '' %>>Tailwind CSS</option>
                <option value="Redux" data-icon="devicon-redux-original" <%= skillsArray.includes('Redux') ? 'selected' : '' %>>Redux</option>
                <option value="GraphQL" data-icon="devicon-graphql-plain" <%= skillsArray.includes('GraphQL') ? 'selected' : '' %>>GraphQL</option>
                <option value="Sass" data-icon="devicon-sass-original" <%= skillsArray.includes('Sass') ? 'selected' : '' %>>Sass</option>
                <option value="Webpack" data-icon="devicon-webpack-plain" <%= skillsArray.includes('Webpack') ? 'selected' : '' %>>Webpack</option>
                <option value="Figma" data-icon="devicon-figma-plain" <%= skillsArray.includes('Figma') ? 'selected' : '' %>>Figma</option>
                <option value="Java" data-icon="devicon-java-plain" <%= skillsArray.includes('Java') ? 'selected' : '' %>>Java</option>
                <option value="Spring" data-icon="devicon-spring-plain" <%= skillsArray.includes('Spring') ? 'selected' : '' %>>Spring</option>
                <option value="C++" data-icon="devicon-cplusplus-plain" <%= skillsArray.includes('C++') ? 'selected' : '' %>>C++</option>
                <option value="C#" data-icon="devicon-csharp-plain" <%= skillsArray.includes('C#') ? 'selected' : '' %>>C#</option>
                <option value="Go" data-icon="devicon-go-plain" <%= skillsArray.includes('Go') ? 'selected' : '' %>>Go</option>
                <option value="Ruby" data-icon="devicon-ruby-plain" <%= skillsArray.includes('Ruby') ? 'selected' : '' %>>Ruby</option>
                <option value="Rails" data-icon="devicon-rails-plain" <%= skillsArray.includes('Rails') ? 'selected' : '' %>>Rails</option>
                <option value="Angular" data-icon="devicon-angularjs-plain" <%= skillsArray.includes('Angular') ? 'selected' : '' %>>Angular</option>
                <option value="Svelte" data-icon="devicon-svelte-plain" <%= skillsArray.includes('Svelte') ? 'selected' : '' %>>Svelte</option>
              </select>
              <small class="form-help">Select multiple skills (searchable)</small>
            </div>

            <div class="form-group">
              <label for="linkedin">LinkedIn URL</label>
              <input type="url" id="linkedin" name="linkedin" class="form-control" placeholder="https://linkedin.com/in/username" value="<%= isEdit ? (member.linkedin || '') : '' %>">
            </div>

            <div class="form-group">
              <label for="github">GitHub URL</label>
              <input type="url" id="github" name="github" class="form-control" placeholder="https://github.com/username" value="<%= isEdit ? (member.github || '') : '' %>">
            </div>

            <div class="form-group">
              <label for="twitter">Twitter URL</label>
              <input type="url" id="twitter" name="twitter" class="form-control" placeholder="https://twitter.com/username" value="<%= isEdit ? (member.twitter || '') : '' %>">
            </div>

            <div class="form-group">
              <label for="instagram">Instagram URL</label>
              <input type="url" id="instagram" name="instagram" class="form-control" placeholder="https://instagram.com/username" value="<%= isEdit ? (member.instagram || '') : '' %>">
            </div>

            <div class="form-group">
              <label for="facebook">Facebook URL</label>
              <input type="url" id="facebook" name="facebook" class="form-control" placeholder="https://facebook.com/username" value="<%= isEdit ? (member.facebook || '') : '' %>">
            </div>

            <% if (!isEdit) { %>
            <!-- Display order is auto-set, hidden field -->
            <input type="hidden" id="display_order" name="display_order" value="<%= member.display_order || 0 %>">
            <% } else { %>
            <!-- Display order is hidden in edit mode, use reorder modal from team list instead -->
            <input type="hidden" id="display_order" name="display_order" value="<%= member.display_order || 0 %>">
            <% } %>

            <div class="form-group full-width">
              <label class="checkbox-group">
                <input type="checkbox" id="is_active" name="is_active" value="true" <%= (isEdit && member.is_active) || !isEdit ? 'checked' : '' %>>
                <span>Active (Show on team page)</span>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <a href="/admin/team" class="btn btn-secondary" title="Cancel">
              <i class="fas fa-times"></i>
            </a>
            <button type="submit" class="btn btn-submit" id="submitBtn" title="<%= isEdit ? 'Update' : 'Add' %> Team Member">
              <i class="fas fa-<%= isEdit ? 'save' : 'plus' %>"></i> <%= isEdit ? 'Update' : 'Add' %> Team Member
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="success-modal" id="successModal">
    <div class="modal-content-wrapper">
      <div class="modal-icon">
        <i class="fas fa-check"></i>
      </div>
      <h3 class="modal-title" id="successTitle"><%= isEdit ? 'Team Member Updated!' : 'Team Member Created!' %></h3>
      <p class="modal-message" id="successMessage"><%= isEdit ? 'The team member has been successfully updated.' : 'The team member has been successfully added to your team.' %></p>
      <div class="modal-actions">
        <a href="/admin/team" class="modal-btn modal-btn-secondary">View Team</a>
        <% if (!isEdit) { %>
        <a href="/admin/team/add" class="modal-btn modal-btn-primary">Add Another</a>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Error Modal -->
  <div class="success-modal" id="errorModal">
    <div class="modal-content-wrapper">
      <div class="modal-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3 class="modal-title">Error Occurred</h3>
      <p class="modal-message" id="errorMessage">Something went wrong. Please try again.</p>
      <div class="modal-actions">
        <button onclick="closeModal('errorModal')" class="modal-btn modal-btn-primary">Close</button>
      </div>
    </div>
  </div>

  <!-- jQuery (required for Select2) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script>

    function showModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.add('show');
      }
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('show');
      }
    }


    window.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const isEditMode = <%= JSON.stringify(isEdit) %>;
      
      if (urlParams.get('success') === 'true') {

        const role = localStorage.getItem('lastCreatedRole');
        if (!isEditMode && role) {
          const titleEl = document.getElementById('successTitle');
          const messageEl = document.getElementById('successMessage');
          
          if (role === 'admin') {
            titleEl.textContent = 'Admin Created!';
            messageEl.textContent = 'The admin has been successfully added to your team with elevated access.';
          } else {
            titleEl.textContent = 'Team Member Created!';
            messageEl.textContent = 'The team member has been successfully added to your team.';
          }
          localStorage.removeItem('lastCreatedRole');
        }
        
        showModal('successModal');
        

        if (!isEditMode) {
          setTimeout(function() {
            const form = document.getElementById('teamForm');
            if (form) {
              form.reset();

              $('.skills-select').val(null).trigger('change');

              const avatarPreviewImg = document.getElementById('avatarPreviewImg');
              if (avatarPreviewImg) {
                avatarPreviewImg.src = '/images/default-avatar.webp';
              }
            }
          }, 100);
        }
      } else if (urlParams.get('error') === 'true') {
        const errorMsg = decodeURIComponent(urlParams.get('message') || 'Something went wrong. Please try again.');
        document.getElementById('errorMessage').textContent = errorMsg;
        showModal('errorModal');
      }
    });


    const teamForm = document.getElementById('teamForm');
    const submitBtn = document.getElementById('submitBtn');
    
    if (teamForm) {
      teamForm.addEventListener('submit', async function(e) {
        e.preventDefault();

        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        }

        try {

          if (avatarInput && avatarInput.files && avatarInput.files.length > 0) {
            const file = avatarInput.files[0];
            try {
              uploadedAvatarUrl = await uploadAvatarChunked(file);
            } catch (error) {
              console.error('Error uploading avatar:', error);
              alert(`Failed to upload avatar: ${error.message}`);
              if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-<%= isEdit ? "save" : "plus" %>"></i> <%= isEdit ? "Update" : "Add" %> Team Member';
              }
              return;
            }
          }

          if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
          }


          const roleSelect = document.getElementById('role');
          if (roleSelect) {
            localStorage.setItem('lastCreatedRole', roleSelect.value);
          }


          const formData = new FormData();
          

          const formInputs = teamForm.querySelectorAll('input:not([type="file"]), select, textarea');
          formInputs.forEach(input => {

            if (input.id === 'skills') {
              return;
            }
            
            if (input.name && input.type !== 'file') {
              if (input.type === 'checkbox') {
                if (input.checked) {
                  formData.append(input.name, input.value || 'true');
                }
              } else if (input.type === 'radio') {
                if (input.checked) {
                  formData.append(input.name, input.value);
                }
              } else {
                formData.append(input.name, input.value);
              }
            }
          });
          

          const skillsSelect = document.getElementById('skills');
          if (skillsSelect) {
            const selectedSkills = $(skillsSelect).val();
            if (selectedSkills && Array.isArray(selectedSkills)) {
              selectedSkills.forEach(skill => {
                formData.append('skills[]', skill);
              });
            }
          }
          

          if (uploadedAvatarUrl) {
            formData.append('avatarUrl', uploadedAvatarUrl);
          }


          const xhr = new XMLHttpRequest();

          xhr.addEventListener('load', function() {
            if (xhr.status >= 200 && xhr.status < 400) {
              const finalUrl = xhr.responseURL;
              if (finalUrl) {
                try {
                  const url = new URL(finalUrl);
                  window.location.href = url.pathname + url.search;
                } catch (e) {
                  const match = finalUrl.match(/https?:\/\/[^\/]+(\/.*)/);
                  if (match) {
                    window.location.href = match[1];
                  } else {
                    window.location.href = finalUrl;
                  }
                }
              } else {
                window.location.reload();
              }
            } else {
              alert('Error saving team member. Please try again.');
              if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-<%= isEdit ? "save" : "plus" %>"></i> <%= isEdit ? "Update" : "Add" %> Team Member';
              }
            }
          });

          xhr.addEventListener('error', function() {
            alert('Network error. Please check your connection and try again.');
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<i class="fas fa-<%= isEdit ? "save" : "plus" %>"></i> <%= isEdit ? "Update" : "Add" %> Team Member';
            }
          });

          xhr.open('POST', teamForm.action);
          xhr.timeout = 300000;
          
          xhr.addEventListener('timeout', function() {
            alert('Upload timeout. The file may be too large or your connection is slow.');
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<i class="fas fa-<%= isEdit ? "save" : "plus" %>"></i> <%= isEdit ? "Update" : "Add" %> Team Member';
            }
          });
          
          xhr.send(formData);
        } catch (error) {
          console.error('Error submitting form:', error);
          alert('An error occurred: ' + error.message);
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-<%= isEdit ? "save" : "plus" %>"></i> <%= isEdit ? "Update" : "Add" %> Team Member';
          }
        }
      });
    }


    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('success-modal')) {
        closeModal(e.target.id);
      }
    });


    $(document).ready(function() {
      $('.skills-select').select2({
        placeholder: 'Search and select skills...',
        allowClear: true,
        closeOnSelect: false,
        width: '100%',
        templateResult: formatSkill,
        templateSelection: formatSkillSelection
      });


      $('.skills-select').on('select2:select', function (e) {
        setTimeout(function() {
          $('.select2-search__field').val('');
        }, 50);
      });


      function formatSkill(skill) {
        if (!skill.id) {
          return skill.text;
        }
        
        var iconClass = $(skill.element).data('icon');
        if (!iconClass) {
          return skill.text;
        }
        
        var $skill = $(
          '<span><i class="' + iconClass + '"></i> ' + skill.text + '</span>'
        );
        return $skill;
      }


      function formatSkillSelection(skill) {
        return skill.text;
      }
    });


    const avatarInput = document.getElementById('avatar');
    const avatarPreview = document.getElementById('avatarPreview');
    const avatarPreviewImg = document.getElementById('avatarPreviewImg');
    const currentAvatar = document.getElementById('currentAvatar');




    const CHUNK_SIZE = 750 * 1024; 
    const MAX_FILE_SIZE = 5 * 1024 * 1024; 
    let uploadedAvatarUrl = null;

    /**
     * Upload avatar using chunked upload
     */
    async function uploadAvatarChunked(file) {
      return new Promise(async (resolve, reject) => {
        try {

          if (file.size > MAX_FILE_SIZE) {
            reject(new Error(`File "${file.name}" exceeds 5MB limit`));
            return;
          }


          const uploadIdResponse = await fetch('/admin/api/chunked-upload/upload-id');
          
          if (!uploadIdResponse.ok) {
            const errorText = await uploadIdResponse.text();
            reject(new Error(`Failed to get upload ID: ${uploadIdResponse.status} ${uploadIdResponse.statusText}. ${errorText.substring(0, 100)}`));
            return;
          }

          const contentType = uploadIdResponse.headers.get('content-type');
          if (!contentType || !contentType.includes('application/json')) {
            const errorText = await uploadIdResponse.text();
            reject(new Error(`Invalid response format. Expected JSON but got: ${contentType}. ${errorText.substring(0, 100)}`));
            return;
          }

          const uploadIdData = await uploadIdResponse.json();
          
          if (!uploadIdData.success) {
            reject(new Error(uploadIdData.message || 'Failed to get upload ID'));
            return;
          }

          const uploadId = uploadIdData.uploadId;
          const totalChunks = Math.ceil(file.size / CHUNK_SIZE);


          for (let chunkIndex = 0; chunkIndex < totalChunks; chunkIndex++) {
            const start = chunkIndex * CHUNK_SIZE;
            const end = Math.min(start + CHUNK_SIZE, file.size);
            const chunk = file.slice(start, end);


            const chunkBase64 = await new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => {
                const base64 = reader.result.split(',')[1];
                resolve(base64);
              };
              reader.onerror = reject;
              reader.readAsDataURL(chunk);
            });


            const formData = new FormData();
            formData.append('uploadId', uploadId);
            formData.append('chunkIndex', chunkIndex);
            formData.append('totalChunks', totalChunks);
            formData.append('fileName', file.name);
            formData.append('fileSize', file.size);
            formData.append('chunkData', chunkBase64);

            const chunkResponse = await fetch('/admin/api/chunked-upload/chunk', {
              method: 'POST',
              body: formData
            });

            if (!chunkResponse.ok) {
              const errorText = await chunkResponse.text();
              reject(new Error(`Upload failed: ${chunkResponse.status} ${chunkResponse.statusText}. ${errorText.substring(0, 100)}`));
              return;
            }

            const contentType = chunkResponse.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
              const errorText = await chunkResponse.text();
              reject(new Error(`Invalid response format. Expected JSON but got: ${contentType}. ${errorText.substring(0, 100)}`));
              return;
            }

            const chunkResult = await chunkResponse.json();
            
            if (!chunkResult.success) {
              reject(new Error(chunkResult.message || 'Failed to upload chunk'));
              return;
            }
          }


          const completeFormData = new FormData();
          completeFormData.append('uploadId', uploadId);
          completeFormData.append('fileName', file.name);
          completeFormData.append('type', 'avatar');

          const completeResponse = await fetch('/admin/api/chunked-upload/complete', {
            method: 'POST',
            body: completeFormData
          });

          if (!completeResponse.ok) {
            const errorText = await completeResponse.text();
            reject(new Error(`Complete upload failed: ${completeResponse.status} ${completeResponse.statusText}. ${errorText.substring(0, 100)}`));
            return;
          }

          const completeContentType = completeResponse.headers.get('content-type');
          if (!completeContentType || !completeContentType.includes('application/json')) {
            const errorText = await completeResponse.text();
            reject(new Error(`Invalid response format. Expected JSON but got: ${completeContentType}. ${errorText.substring(0, 100)}`));
            return;
          }

          const completeResult = await completeResponse.json();
          
          if (!completeResult.success) {
            reject(new Error(completeResult.message || 'Failed to complete upload'));
            return;
          }

          resolve(completeResult.url);
        } catch (error) {
          reject(error);
        }
      });
    }

    function processFile(file) {
      if (!file) return;

      if (file.size > 5 * 1024 * 1024) {
        const errorMessageEl = document.getElementById('errorMessage');
        if (errorMessageEl) {
          errorMessageEl.textContent = 'File size must be less than 5MB. Please select a smaller image.';
        }
        showModal('errorModal');
        if (avatarInput) {
          avatarInput.value = '';
        }
        return;
      }

      if (!file.type.startsWith('image/')) {
        alert('Please select an image file');
        if (avatarInput) {
          avatarInput.value = '';
        }
        return;
      }


      const reader = new FileReader();
      reader.onload = (e) => {
        avatarPreviewImg.src = e.target.result;

        if (currentAvatar) {
          currentAvatar.src = e.target.result;
        }
      };
      reader.readAsDataURL(file);


      uploadedAvatarUrl = null; 

      if (avatarInput) {
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        avatarInput.files = dataTransfer.files;
      }
    }

    if (avatarPreview && avatarInput) {

      avatarPreview.addEventListener('click', () => {
        avatarInput.click();
      });


      avatarInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        processFile(file);
      });


      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        avatarPreview.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }


      ['dragenter', 'dragover'].forEach(eventName => {
        avatarPreview.addEventListener(eventName, () => {
          avatarPreview.classList.add('drag-over');
        }, false);
      });


      ['dragleave', 'drop'].forEach(eventName => {
        avatarPreview.addEventListener(eventName, () => {
          avatarPreview.classList.remove('drag-over');
        }, false);
      });


      avatarPreview.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
          processFile(files[0]);
        }
      }, false);
    }
  </script>
</body>
</html>

