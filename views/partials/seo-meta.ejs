<% 
  // Default SEO values
  const siteName = 'Backpack Tech Works';
  const siteUrl = process.env.SITE_URL || 'https://backpack2u.com';
  const defaultImage = `${siteUrl}/Backpack.webp`;
  const defaultDescription = 'Backpack Tech Works - Expert software development solutions. We create smart, practical solutions that turn ideas into reality.';
  const defaultKeywords = 'software development, web development, mobile apps, digital solutions, tech consulting, Backpack Tech Works';
  
  // Extract SEO data from locals or use defaults
  const seo = {
    title: typeof title !== 'undefined' ? title : siteName,
    description: typeof seoDescription !== 'undefined' ? seoDescription : defaultDescription,
    keywords: typeof seoKeywords !== 'undefined' ? seoKeywords : defaultKeywords,
    image: typeof seoImage !== 'undefined' ? seoImage : defaultImage,
    url: typeof seoUrl !== 'undefined' ? seoUrl : (siteUrl + (typeof currentPath !== 'undefined' ? currentPath : '/')),
    type: typeof seoType !== 'undefined' ? seoType : 'website',
    author: typeof seoAuthor !== 'undefined' ? seoAuthor : siteName,
    publishedTime: typeof seoPublishedTime !== 'undefined' ? seoPublishedTime : null,
    modifiedTime: typeof seoModifiedTime !== 'undefined' ? seoModifiedTime : null,
    section: typeof seoSection !== 'undefined' ? seoSection : null,
    tags: typeof seoTags !== 'undefined' ? seoTags : [],
    canonical: typeof canonicalUrl !== 'undefined' ? canonicalUrl : (siteUrl + (typeof currentPath !== 'undefined' ? currentPath : '/')),
    robots: typeof robotsMeta !== 'undefined' ? robotsMeta : 'index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1',
    noindex: typeof noindex !== 'undefined' ? noindex : false,
    nofollow: typeof nofollow !== 'undefined' ? nofollow : false
  };
  
  // Ensure image URL is absolute
  if (seo.image && !seo.image.startsWith('http')) {
    seo.image = seo.image.startsWith('/') ? siteUrl + seo.image : siteUrl + '/' + seo.image;
  }
  
  // Ensure URL is absolute
  if (seo.url && !seo.url.startsWith('http')) {
    seo.url = seo.url.startsWith('/') ? siteUrl + seo.url : siteUrl + '/' + seo.url;
  }
  
  // Build robots meta
  if (seo.noindex || seo.nofollow) {
    const robotsParts = [];
    if (seo.noindex) robotsParts.push('noindex');
    if (seo.nofollow) robotsParts.push('nofollow');
    seo.robots = robotsParts.join(', ');
  }
%>

<!-- Primary Meta Tags -->
<meta name="title" content="<%= seo.title %>">
<meta name="description" content="<%= seo.description %>">
<meta name="keywords" content="<%= seo.keywords %>">
<meta name="author" content="<%= seo.author %>">
<meta name="robots" content="<%= seo.robots %>">
<meta name="language" content="English">
<meta name="revisit-after" content="7 days">
<meta name="theme-color" content="#6366f1">

<!-- Canonical URL -->
<link rel="canonical" href="<%= seo.canonical %>">

<!-- Preconnect to external domains for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="<%= seo.type %>">
<meta property="og:url" content="<%= seo.url %>">
<meta property="og:title" content="<%= seo.title %>">
<meta property="og:description" content="<%= seo.description %>">
<meta property="og:image" content="<%= seo.image %>">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt" content="<%= seo.title %>">
<meta property="og:site_name" content="<%= siteName %>">
<meta property="og:locale" content="en_US">
<% if (seo.publishedTime) { %>
<meta property="article:published_time" content="<%= seo.publishedTime %>">
<% } %>
<% if (seo.modifiedTime) { %>
<meta property="article:modified_time" content="<%= seo.modifiedTime %>">
<% } %>
<% if (seo.section) { %>
<meta property="article:section" content="<%= seo.section %>">
<% } %>
<% if (seo.tags && seo.tags.length > 0) { %>
  <% seo.tags.forEach(tag => { %>
<meta property="article:tag" content="<%= tag %>">
  <% }); %>
<% } %>

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="<%= seo.url %>">
<meta name="twitter:title" content="<%= seo.title %>">
<meta name="twitter:description" content="<%= seo.description %>">
<meta name="twitter:image" content="<%= seo.image %>">
<meta name="twitter:image:alt" content="<%= seo.title %>">
<meta name="twitter:site" content="@backpacktech">
<meta name="twitter:creator" content="@backpacktech">

<!-- Additional SEO Meta Tags -->
<meta name="geo.region" content="US">
<meta name="geo.placename" content="United States">
<meta name="rating" content="general">
<meta name="distribution" content="global">
<meta name="coverage" content="worldwide">
<meta name="target" content="all">
<meta name="HandheldFriendly" content="true">
<meta name="MobileOptimized" content="320">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "<%= siteUrl %>/#organization",
      "name": "<%= siteName %>",
      "url": "<%= siteUrl %>",
      "logo": {
        "@type": "ImageObject",
        "url": "<%= siteUrl %>/Backpack.webp",
        "width": 512,
        "height": 512
      },
      "sameAs": [
        "https://www.linkedin.com/company/backpacktechwork",
        "https://github.com/BackpackTechWork",
        "https://x.com/backpacktechw",
        "https://www.tiktok.com/@backpacktechworks",
        "https://www.instagram.com/backpacktechworks/",
        "https://www.facebook.com/profile.php?id=61574869127595",
        "https://www.youtube.com/@BackpackTechworks",
        "http://wa.link/2y0zm0"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Customer Service",
        "url": "<%= siteUrl %>/contact"
      }
    },
    {
      "@type": "WebSite",
      "@id": "<%= siteUrl %>/#website",
      "url": "<%= siteUrl %>",
      "name": "<%= siteName %>",
      "description": "<%= defaultDescription %>",
      "publisher": {
        "@id": "<%= siteUrl %>/#organization"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "<%= siteUrl %>/search?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    <% if (typeof structuredData !== 'undefined' && structuredData) { %>
    ,<%- JSON.stringify(structuredData).replace(/</g, '\\u003c').replace(/>/g, '\\u003e') %>
    <% } %>
    <% if (typeof breadcrumbs !== 'undefined' && breadcrumbs && breadcrumbs.length > 0) { %>
    ,{
      "@type": "BreadcrumbList",
      "@id": "<%= siteUrl %><%= typeof currentPath !== 'undefined' ? currentPath : '/' %>#breadcrumb",
      "itemListElement": [
        <% breadcrumbs.forEach((crumb, index) => { %>
        {
          "@type": "ListItem",
          "position": <%= index + 1 %>,
          "name": "<%= crumb.name %>",
          "item": "<%= crumb.url.startsWith('http') ? crumb.url : siteUrl + crumb.url %>"
        }<%= index < breadcrumbs.length - 1 ? ',' : '' %>
        <% }); %>
      ]
    }
    <% } %>
  ]
}
</script>

